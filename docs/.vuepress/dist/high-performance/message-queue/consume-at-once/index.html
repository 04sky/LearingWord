<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实现Kafka至少成功消费一次 | LearnWord</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="专注技术分享，从后端八股到实践">
    
    <link rel="preload" href="/LearingWord/assets/css/0.styles.8ee1b52f.css" as="style"><link rel="preload" href="/LearingWord/assets/js/app.352ff452.js" as="script"><link rel="preload" href="/LearingWord/assets/js/2.a91a21bc.js" as="script"><link rel="preload" href="/LearingWord/assets/js/6.9f44c348.js" as="script"><link rel="prefetch" href="/LearingWord/assets/js/10.8ba1676f.js"><link rel="prefetch" href="/LearingWord/assets/js/11.e02b8512.js"><link rel="prefetch" href="/LearingWord/assets/js/12.38e44c72.js"><link rel="prefetch" href="/LearingWord/assets/js/3.a5dff05d.js"><link rel="prefetch" href="/LearingWord/assets/js/4.acaee825.js"><link rel="prefetch" href="/LearingWord/assets/js/5.b66c11d1.js"><link rel="prefetch" href="/LearingWord/assets/js/7.69bf0675.js"><link rel="prefetch" href="/LearingWord/assets/js/8.046c8596.js"><link rel="prefetch" href="/LearingWord/assets/js/9.93a42852.js">
    <link rel="stylesheet" href="/LearingWord/assets/css/0.styles.8ee1b52f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/LearingWord/" class="home-link router-link-active"><!----> <span class="site-name">LearnWord</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/LearingWord/" class="nav-link">主页</a></div><div class="nav-item"><a href="/LearingWord/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/LearingWord/home.html" class="nav-link">LearnWord</a></div><div class="nav-item"><a href="/LearingWord/books/" class="nav-link">推荐书籍</a></div><div class="nav-item"><a href="/LearingWord/wechat-official-accounts/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/LearingWord/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/LearingWord/" class="nav-link">主页</a></div><div class="nav-item"><a href="/LearingWord/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/LearingWord/home.html" class="nav-link">LearnWord</a></div><div class="nav-item"><a href="/LearingWord/books/" class="nav-link">推荐书籍</a></div><div class="nav-item"><a href="/LearingWord/wechat-official-accounts/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/LearingWord/about/" class="nav-link">关于</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/LearingWord/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/LearingWord/categories/?category=high-performance" title="分类" data-v-06225672>high-performance</a></li><li data-v-06225672><a href="/LearingWord/categories/?category=message-queue" title="分类" data-v-06225672>message-queue</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>sky</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-12-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">实现Kafka至少成功消费一次<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="实现kafka至少消费一次"><a href="#实现kafka至少消费一次" class="header-anchor">#</a> 实现Kafka至少消费一次</h1> <blockquote><p>在实际重要的场景中，常常需要实现消费者至少消费一次。因为使用默认的kafka消费者存在某些问题。</p></blockquote> <h2 id="默认的kafka消费者存在什么问题"><a href="#默认的kafka消费者存在什么问题" class="header-anchor">#</a> 默认的kafka消费者存在什么问题？</h2> <p>（1）需要自己实现重新消费数据</p> <blockquote><p>在刚开始思考时，有人认为实现重复消费还不简单？取消自动提交，确认一批消息已经消费成功就执行手动提交，否则不提交；之后重新获取未提交的数据，就可以达到重复消费的目的。</p> <p>可是，事实是残酷的，试一次就知道，感觉手动不提交没有用一样😂，消费者一直在往后消费。</p></blockquote> <p>对于Kafka中的分区而言，它的每条消息都有唯一的 offset ，用来表示消息在分区中对应的位置（called：偏移量）。 对于消费者而言，它也有一个 offset 的概念，消费者使用offset来表示消费到分区中某个消息所在的位置（called：位移）。偏移量存储在Kafka内部的主题 __consumer_offsets 中，而位移存储在消费者端的内存中。“提交”就是将消费者端存储的位移存储到 __consumer_offsets 持久化，当消费者发生崩溃或发生消费者重平衡时，就会去读取存储在 __consumer_offsets 中的偏移量，其他正常情况下都是按内存存储的位移在顺序读取。因此，按照上述操作就会出现提交没用的效果。</p> <p>（2）自动提交情况下，可能出现消息丢失情况
拉取线程 A 不断地拉取消息并存入本地缓存，比如在 BlockingQueue 中，另一个处理线程 B 从缓存中读取消息并进行相应的逻辑处理。假设目前进行到了第 y+1 次拉取，以及第 m 次位移提交的时候，也就是 x+6 之前的位移己经确认提交了，处理线程 B 却还正在消费 x+3 的消息 。 此时如果处理线程B 发生了异常，待其恢复之后会从第 m 次位移提交处，也就是 x+6 的位置开始拉取消息，那么 x+3 至 x+6 之间的消息就没有得到相应的处理，这样便发生消息丢失的现象 。</p> <p><img src="/LearingWord/assets/img/kafka-msg-drop.35d6fca2.png" alt="kafka-msg-drop.png"></p> <h2 id="实现至少消费一次"><a href="#实现至少消费一次" class="header-anchor">#</a> 实现至少消费一次</h2> <blockquote><p>语言：python 3.8
工具：confluent-kafka</p></blockquote> <p>目前有2个思路，第1个时新建一个重试队列，当遇到问题消息时将其插入到重试队列中，消费者可以再次获取到该问题消息并再次消费。第2个是通过 seek 方法设置位移到指定发生问题的位置，使得重新消费问题消息；</p> <h3 id="加入重试队列再次消费"><a href="#加入重试队列再次消费" class="header-anchor">#</a> 加入重试队列再次消费</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">KafkaAtLeastOnceConsumer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    注意：
    1. 用户方法须返回Boolean类型数据，False将可能重新消费该数据
    2. 用户消息内容不得包含 try_count、old_topic 关键字

    &quot;&quot;&quot;</span>

    run_flag <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">if</span> config<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>
        total_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            group_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
            topic_list<span class="token punctuation">:</span> List<span class="token punctuation">,</span>
            user_function<span class="token punctuation">:</span> Callable<span class="token punctuation">,</span>
            servers<span class="token punctuation">:</span> List <span class="token operator">=</span> config<span class="token punctuation">.</span>KAFKA_HOST<span class="token punctuation">,</span>
            consumer_count<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
            reset_type<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'latest'</span><span class="token punctuation">,</span>
            concurrency<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
            batch_size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
            timeout<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
            base_mode<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
            retry_count<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> consumer_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'消费者数目须大于0'</span>
        <span class="token keyword">assert</span> concurrency <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'消费者并发度须大于0'</span>
        <span class="token keyword">assert</span> batch_size <span class="token operator">&gt;</span> concurrency<span class="token punctuation">,</span> <span class="token string">'单批消息数须大于并发度'</span>
        <span class="token keyword">assert</span> timeout <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'获取消息超时时间须大于0'</span>
        <span class="token keyword">assert</span> retry_count <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'重试次数应大于等于-1'</span>

        self<span class="token punctuation">.</span>_consumer_count <span class="token operator">=</span> consumer_count
        self<span class="token punctuation">.</span>_pool <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span>self<span class="token punctuation">.</span>_consumer_count<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_servers <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>servers<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_group_id <span class="token operator">=</span> group_id
        self<span class="token punctuation">.</span>_user_function <span class="token operator">=</span> user_function
        self<span class="token punctuation">.</span>_reset_type <span class="token operator">=</span> reset_type
        self<span class="token punctuation">.</span>_topic_list <span class="token operator">=</span> topic_list
        self<span class="token punctuation">.</span>_concurrency <span class="token operator">=</span> concurrency
        self<span class="token punctuation">.</span>_batch_size <span class="token operator">=</span> batch_size
        self<span class="token punctuation">.</span>_timeout <span class="token operator">=</span> timeout
        self<span class="token punctuation">.</span>_retry_count <span class="token operator">=</span> retry_count

        self<span class="token punctuation">.</span>_process_num_per_thread <span class="token operator">=</span> <span class="token number">100</span>
        self<span class="token punctuation">.</span>_retry_topic_name <span class="token operator">=</span> <span class="token string">'kfk_retry_queue'</span>
        self<span class="token punctuation">.</span>_inner_producer <span class="token operator">=</span> <span class="token boolean">None</span>

        self<span class="token punctuation">.</span>_topic_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_retry_topic_name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> base_mode<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_retry_count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_consumer_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_core<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">shutdown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        KafkaAtLeastOnceConsumer<span class="token punctuation">.</span>run_flag <span class="token operator">=</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">_split_msgs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msgs<span class="token punctuation">:</span> List<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">:</span>
        msg_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span>
        <span class="token keyword">if</span> msg_num <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>_process_num_per_thread <span class="token operator">*</span> self<span class="token punctuation">.</span>_concurrency<span class="token punctuation">:</span>
            process_num_per_thread <span class="token operator">=</span> self<span class="token punctuation">.</span>_process_num_per_thread
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            process_num_per_thread <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>msg_num <span class="token operator">/</span> self<span class="token punctuation">.</span>_concurrency<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>chunked<span class="token punctuation">(</span>msgs<span class="token punctuation">,</span> process_num_per_thread<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_core</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            consumer <span class="token operator">=</span> self<span class="token punctuation">.</span>_init_consumer<span class="token punctuation">(</span><span class="token punctuation">)</span>
            batch_pool <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span>self<span class="token punctuation">.</span>_concurrency<span class="token punctuation">)</span>
            <span class="token keyword">while</span> KafkaAtLeastOnceConsumer<span class="token punctuation">.</span>run_flag<span class="token punctuation">:</span>
                msgs <span class="token operator">=</span> consumer<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>num_messages<span class="token operator">=</span>self<span class="token punctuation">.</span>_batch_size<span class="token punctuation">,</span> timeout<span class="token operator">=</span>self<span class="token punctuation">.</span>_timeout<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> msgs<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> config<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>
                    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'开始处理一批消息'</span></span><span class="token punctuation">)</span>
                msg_lists <span class="token operator">=</span> self<span class="token punctuation">.</span>_split_msgs<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span><span class="token punctuation">)</span>
                threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> msg_list <span class="token keyword">in</span> msg_lists<span class="token punctuation">:</span>
                    t <span class="token operator">=</span> batch_pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_thread_run<span class="token punctuation">,</span> msg_list<span class="token punctuation">)</span>
                    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
                wait<span class="token punctuation">(</span>threads<span class="token punctuation">)</span>
                consumer<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> config<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>
                    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'完成处理一批消息'</span></span><span class="token punctuation">)</span>
                    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'total_set:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>KafkaAtLeastOnceConsumer<span class="token punctuation">.</span>total_set<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            log<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> consumer<span class="token punctuation">:</span>
                    consumer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> batch_pool<span class="token punctuation">:</span>
                    batch_pool<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                log<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_thread_run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg_list<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> msg <span class="token keyword">in</span> msg_list<span class="token punctuation">:</span>
            msg_map <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">'old_topic'</span> <span class="token keyword">in</span> msg_map <span class="token keyword">and</span> msg_map<span class="token punctuation">[</span><span class="token string">'old_topic'</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>_topic_list<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">try</span><span class="token punctuation">:</span>
                func_is_success <span class="token operator">=</span> self<span class="token punctuation">.</span>_user_function<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
                func_is_success <span class="token operator">=</span> <span class="token boolean">False</span>

            <span class="token keyword">if</span> <span class="token keyword">not</span> func_is_success<span class="token punctuation">:</span>
                <span class="token keyword">if</span> msg<span class="token punctuation">.</span>topic<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>_retry_topic_name<span class="token punctuation">:</span>
                    try_count <span class="token operator">=</span> msg_map<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'try_count'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    try_count <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>_retry_count <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>_retry_count <span class="token operator">&lt;=</span> try_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 重试操作</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_inner_producer<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>_inner_producer <span class="token operator">=</span> self<span class="token punctuation">.</span>_init_producer<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    msg_map<span class="token punctuation">[</span><span class="token string">'try_count'</span><span class="token punctuation">]</span> <span class="token operator">=</span> try_count <span class="token operator">+</span> <span class="token number">1</span>
                    msg_map<span class="token punctuation">[</span><span class="token string">'old_topic'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_topic_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>_inner_producer<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_retry_topic_name<span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>msg_map<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> config<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>
                KafkaAtLeastOnceConsumer<span class="token punctuation">.</span>total_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_init_consumer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Consumer<span class="token punctuation">:</span>
        _consumer <span class="token operator">=</span> Consumer<span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
                <span class="token string">'bootstrap.servers'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_servers<span class="token punctuation">,</span>
                <span class="token string">'group.id'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_group_id<span class="token punctuation">,</span>
                <span class="token string">'auto.offset.reset'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_reset_type<span class="token punctuation">,</span>
                <span class="token string">'enable.auto.commit'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        _consumer<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_topic_list<span class="token punctuation">)</span>
        <span class="token keyword">return</span> _consumer

    <span class="token keyword">def</span> <span class="token function">_init_producer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Producer<span class="token punctuation">:</span>
        _producer <span class="token operator">=</span> Producer<span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
                <span class="token string">'bootstrap.servers'</span><span class="token punctuation">:</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>config<span class="token punctuation">.</span>KAFKA_HOST<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> _producer
</code></pre></div><ol><li>同时开启 consumer_count 个消费者并处于同一分组中，为了提高吞吐量，每个消费者又会开启 concurrency 个线程去消费数据</li> <li>当消费消费出现异常或返回False，并且重试次数没有使用完毕，就会将初始消息以及重试次数发送到“重试队列”</li> <li>关闭自动提交，开启手动提交，当消费者端崩溃或再平衡时再次消费未提交数据。</li></ol> <p>测试代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_get_msg_data</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> msg<span class="token punctuation">.</span>partition<span class="token punctuation">(</span><span class="token punctuation">)</span>
    o <span class="token operator">=</span> msg<span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t <span class="token operator">=</span> msg<span class="token punctuation">.</span>topic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    value <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> p<span class="token punctuation">,</span> o<span class="token punctuation">,</span> t<span class="token punctuation">,</span> value


<span class="token keyword">def</span> <span class="token function">my_function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'fetch msg is error. error:%s'</span> <span class="token operator">%</span> msg<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token comment"># 处理业务逻辑，单次问题进行重试</span>
    p<span class="token punctuation">,</span> o<span class="token punctuation">,</span> t<span class="token punctuation">,</span> value <span class="token operator">=</span> _get_msg_data<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">if</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;发生业务异常返回False, topic:</span><span class="token interpolation"><span class="token punctuation">{</span>t<span class="token punctuation">}</span></span><span class="token string">, partition:</span><span class="token interpolation"><span class="token punctuation">{</span>p<span class="token punctuation">}</span></span><span class="token string">,  offset </span><span class="token interpolation"><span class="token punctuation">{</span>o<span class="token punctuation">}</span></span><span class="token string">, value:</span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> &quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'业务处理消息，topic:</span><span class="token interpolation"><span class="token punctuation">{</span>t<span class="token punctuation">}</span></span><span class="token string">, partition:</span><span class="token interpolation"><span class="token punctuation">{</span>p<span class="token punctuation">}</span></span><span class="token string">, offset:</span><span class="token interpolation"><span class="token punctuation">{</span>o<span class="token punctuation">}</span></span><span class="token string">, content:</span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">success_function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 处理业务逻辑，完全正常</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'fetch msg is error. error:%s'</span> <span class="token operator">%</span> msg<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    p<span class="token punctuation">,</span> o<span class="token punctuation">,</span> t<span class="token punctuation">,</span> value <span class="token operator">=</span> _get_msg_data<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'业务处理消息，topic:</span><span class="token interpolation"><span class="token punctuation">{</span>t<span class="token punctuation">}</span></span><span class="token string">, partition:</span><span class="token interpolation"><span class="token punctuation">{</span>p<span class="token punctuation">}</span></span><span class="token string">, offset:</span><span class="token interpolation"><span class="token punctuation">{</span>o<span class="token punctuation">}</span></span><span class="token string">, content:</span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">exception_function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 处理业务逻辑，抛出异常重试</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'fetch msg is error. error:%s'</span> <span class="token operator">%</span> msg<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    p<span class="token punctuation">,</span> o<span class="token punctuation">,</span> t<span class="token punctuation">,</span> value <span class="token operator">=</span> _get_msg_data<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">if</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;发生业务异常返回False, topic:</span><span class="token interpolation"><span class="token punctuation">{</span>t<span class="token punctuation">}</span></span><span class="token string">, partition:</span><span class="token interpolation"><span class="token punctuation">{</span>p<span class="token punctuation">}</span></span><span class="token string">,  offset </span><span class="token interpolation"><span class="token punctuation">{</span>o<span class="token punctuation">}</span></span><span class="token string">, value:</span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> &quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'业务异常'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'业务处理消息，topic:</span><span class="token interpolation"><span class="token punctuation">{</span>t<span class="token punctuation">}</span></span><span class="token string">, partition:</span><span class="token interpolation"><span class="token punctuation">{</span>p<span class="token punctuation">}</span></span><span class="token string">, offset:</span><span class="token interpolation"><span class="token punctuation">{</span>o<span class="token punctuation">}</span></span><span class="token string">, content:</span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">test_normal_try_limit</span><span class="token punctuation">(</span>retry_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 用户函数返回false重试(-1无限/数字为重试次数)</span>
    consumer <span class="token operator">=</span> KafkaAtLeastOnceConsumer<span class="token punctuation">(</span>group_id<span class="token punctuation">,</span> <span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">,</span> my_function<span class="token punctuation">,</span> retry_count<span class="token operator">=</span>retry_count<span class="token punctuation">)</span>
    consumer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_exception_try_limit</span><span class="token punctuation">(</span>retry_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 异常指定重试次数(-1无限/数字为重试次数)</span>
    consumer <span class="token operator">=</span> KafkaAtLeastOnceConsumer<span class="token punctuation">(</span>group_id<span class="token punctuation">,</span> <span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">,</span> exception_function<span class="token punctuation">,</span> retry_count<span class="token operator">=</span>retry_count<span class="token punctuation">)</span>
    consumer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_normal_no_try</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 基本模式</span>
    consumer <span class="token operator">=</span> KafkaAtLeastOnceConsumer<span class="token punctuation">(</span>group_id<span class="token punctuation">,</span> <span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">,</span> my_function<span class="token punctuation">,</span> base_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    consumer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_crash_consume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 模拟消费者关停/崩溃，消费者继续消费</span>
    consumer <span class="token operator">=</span> KafkaAtLeastOnceConsumer<span class="token punctuation">(</span>group_id<span class="token punctuation">,</span> <span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">,</span> success_function<span class="token punctuation">,</span> base_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    consumer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    consumer<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    test_channel <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> test_channel <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">:</span>
        test_normal_try_limit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> test_channel <span class="token operator">==</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">:</span>
        test_normal_try_limit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> test_channel <span class="token operator">==</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">:</span>
        test_exception_try_limit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> test_channel <span class="token operator">==</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">:</span>
        test_exception_try_limit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> test_channel <span class="token operator">==</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">:</span>
        test_normal_no_try<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> test_channel <span class="token operator">==</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">:</span>
        test_crash_consume<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        test_normal_try_limit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用seek方法再次消费"><a href="#使用seek方法再次消费" class="header-anchor">#</a> 使用seek方法再次消费</h3> <p>理论上来讲，这种方法是能行的通的。因为seek能将一个活跃分区的消费位移设置到消费失败的位置，然后下一次拉取时可以重新获取该数据，并且相比使用“重试队列”，seek方式还可以保证消息部分顺序。
但是seek在批量处理下存在<a href="https://github.com/confluentinc/confluent-kafka-python/issues/1443" target="_blank" rel="noopener noreferrer">未知问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，后面再研究。</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/LearingWord/tags/?tag=%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97" title="标签">#消息队列</a></div> <!----></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/LearingWord/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/LearingWord/home.html"><div>
            项目相关
            <!----></div></a> <span class="date"></span></dt></dl><dl><dd>02</dd> <dt><a href="/LearingWord/high-performance/message-queue/deploy-kafka-cluster-3-3-1/"><div>
            单机Docker部署应用Kraft模式的Kafka集群
            <!----></div></a> <span class="date">01-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/LearingWord/database/redis/redis-big-key-question/"><div>
            Redis 大Key问题
            <!----></div></a> <span class="date">12-17</span></dt></dl> <dl><dd></dd> <dt><a href="/LearingWord/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:673052752@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://blog.csdn.net/qq_39410381?type=blog" title="csdn" target="_blank" class="iconfont icon-csdn"></a><a href="https://github.com/04sky" title="github" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/sikailin" title="gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/LearingWord/assets/js/app.352ff452.js" defer></script><script src="/LearingWord/assets/js/2.a91a21bc.js" defer></script><script src="/LearingWord/assets/js/6.9f44c348.js" defer></script>
  </body>
</html>
